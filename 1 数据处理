- 数据处理是指根据数据分析的目标将收集到的数据用适当的处理方法进行加工整理，形成适合数据分析的数据，占整个分析工作量的80%，是数据分析必不可少的阶段。

1.1 数据规范

- 数据规范是指可以进行数据分析的数据所需要具备的规范与要求

数据规范的6点要求：
1. 数据表有标题行（字段）和数据部分（记录）组成；
2. 数据表第一行是表的字段名称，不能重复；
3. 第二行起是数据部分，数据部分的每一行数据称为一条记录，并且数据部分不允许出现空白行和空白列，数据要保持完整性。
4. 一个单元格只记录一个属性数据，切勿复合记录，有一说一；
5. 数据表中不能有合并单元格存在；
6. 数据表需要以一维表的形式存储。
- 一维表： 也称为流水线表格，每一列是一个独立的变量，如地区，年份，GDP，适合于数据分析
- 二维表/多维表/交叉表： 有的列不是独立变量，地区，2006年，2007年，2008年，适合于展现分析

* 二维表如何转化为一维表呢？
* 数据处理的只有一个目的：将数据转换为便于处理的一维表格式

1.2 数据导入 - Excel

- 文本导入
Data-From Text-Import-File origin-Delimiters-Column data format
- 数据库导入
Data-From Access-(如果数据库记录数超出Excel容量，应使用透视表/PivotTable)-选取子段/Sum/count。。。
- 网站数据导入
Date-From Web-Copy网址-go-选取数据范围-Import-右键点击数据区域-Refresh-或者数据范围属性-每5分钟更新

1.3 数据清洗

1.3.1 重复数据处理
(按照以下次序依次使用)
- 数据透视表法
- 菜单删除法
- 条件格式标识法
- 高级筛选法
- 函数法（Countif)

- 菜单删除法
Data-Remove duplicate records
只删除重复数据，不会告诉你那些重复了

- 条件格式标识法
选取列-Home-Conditional Formatting-Highlight Cell Rules-Duplicate
将重复记录标准出来，但不会删除。

- 高级筛选法
选取列-Data-Advanced-Advanced Filter-Copy to another location-选取Unique records only
删除重复记录，但不说明重复项和次数

- Countif选取不重复记录
选取待输出的cell-选取函数（fx)-COUNTIF-Range选取要去重的数据-Criteria选取第一个数据值-则待输出cell会出现第一个数据值重复的次数-双击小十字-则每个数据的重复次数自动计算出来
这种方法可以得到重复次数，但不会去重

- 数据透视表法
选中去重数据列-Insert-PivotTable-Create PovotTable-默认值OK-把号码拉到行标签（即按号码分组，也就达到了去重的目的）-把号码拉入汇总区计数（则得到每一个号码的重复次数）- 结果区点击右键选择降序（看到重复最多到最少的有哪些）

1.3.2 缺失数据处理
1）合并单元格的处理
选取合并单元格部分-点击取消合并单元格-CTRL-G定位-定位选项选取Blank-=+向上键-CTRL+Enter

1.3.3 空格数据处理
1）Replace
CTRL-H - Replace " " 为 ""

2) trim函数
FX-trim(cell) - 双击小十字自动完成

1.4 数据抽取
1.4.1 字段拆分
菜单法：数据-分列
函数法：Mid、Left、Right

1）函数法：
点击FX-选取函数-输入参数

2）菜单-分列法：
选取待拆分数据-Data-Data Tools-Text to Column-Fixed width-set break line-next-choose destination or skip some fileds 

1.4.2 记录拆分
随机抽样：Rand + Rank + 填充 + Vlookup
按字段拆分： 常用工具7.3版.xls

1) 随机抽样：Rand + Rank + 填充 + Vlookup
- 从19000个记录里面随机抽取100个记录

1.5 数据合并
1.5.1 字段合并
- 将某个字段合并成一个新字段

1） 函数法： Concatenate， &
Concat函数，输出字符串，不能进行日期运算
Date函数，输出日期值，可以进行运算
不建议使用连接符&，语法比较复杂，容易出错

1.5.2 字段匹配
- 将原数据表中没有的，但其他数据表中有的字段，通过公有的关键字段一一对应
1）单条件： Vlookup（精确匹配）
A表中一系列手机号，但没有品牌信息，B表中有全部品牌信息，这时可以通过VLOOKUP在B表中查找对应的手机号及相应的品牌 类似SQL LEFT JOIN

VLOOKUP注意事项：
1. 匹配不到可能是字段类型不一致（转换成一致），或者有空格
2. B表（维表？）的第一列应该是关键字段列

1.5.2 作业
多条件查询：把两列KEY使用辅助列作为KEY
VLOOKUP(H2&I2,C:E,2,0)

1.5.3 记录合并
- 将具有共同数据字段结构, 但记录信息不同的数据表，合并到一个数据表中

1.6 数据计算
- 简单计算：加、减、乘、除
- 函数计算：日期计算、数据标准化、加权求和、数据分组

1.6.1 简单计算

1.6.2 日期计算
- 函数法： Datedif(起始日期，结束日期，"日期格式参数")
- 日期格式参数：Y-年，M-月，D-天
- 通过入职日期，计算员工的工龄，可以进一步对员工工龄的分布进行统计

DATEDIF函数注意事项：
1）在函数库中无法查找，需要手工输入
2）双引号，逗号要在英文模式下输入

1.6.3 数据标准化
- 将数据按比例缩放，使其落入一个特定的区间，消除变量间的量纲关系（单位）
- 常用的数据标准化方法为0-1标准化：
X*=(X-min)/(max-min)
=(C2-MIN(C:C))/(MAX(C:C)-MIN(C:C))

=A1 =$A$1 =A$1 =$A1
相对引用， 绝对引用， 混合引用。即拖动引用单元时被引用单元会变化

1.6.4 加权求和
权重：某指标在整体指标体系中相对重要程度，表示在其他指标不变的情况下，该指标变化对结果的影响程度
函数法：SUMPRODUCT（区域1，区域2）

1.6.5 数据分组1闭消费分组效果
函数组：IF(条件，满足条件结果，不满足条件结果)
IF函数的限制：
1. 嵌套层数有限制（2003为7层）， 2007-2013（64层）
2. 编写麻烦，容易出错
=IF(B33<30,"[0,30)",IF(B33<60,"[30,60)",IF(B33<100,"[60,100)","100及以上")))

1.6.6 数据分组2
函数法：VLOOKUP(模糊匹配)

先准备一个数据分组对应表
包括升序的阈值列（0，20，40，80，100）和返回分组值列[0,20),[20,40)...
利用VLOOKUP模糊匹配返回小于查询值的最大值的特性来实现

作业2：如何用VLOOKUP实现左开右闭消费分组效果
给阈值列增加一个很小的正数，如0.000000001

1.7 数据转换
1.7.1 行列转置
菜单法： 选择性粘贴-转置
选中表格-> 按CTRL-C -> Paste时选择Transpose转置

1.7.2 类型转换1：文本->数值
- 文本类型的数字无法进行求和、求平均的运算（可以加减乘除）

1）选择性粘贴-运算
- 做一个不改变大小的运算，使其变成数字类型
选取任一单元输入1-copy 1 - 选取需要转换的区域 - paste special - multiply - 转换成数字类型

2）智能标记-转换为数字
选取文本区域 -点击小黄感叹号 - Convert to Number

3) 数据-分列
利用分列功能的第三步

***********************
数据量比较大的情况下，推荐使用数据分列功能（可以整列操作）
***********************

1.7.3 类型转换2： 数值->文本
1） 数据-分列
数据分列第三步列格式选文本
 
2） Text函数
=TEXT(A2/10000,"0.0万")
转换的同时可以改变数字的格式

1.7.4 类型转换3： 数值->日期
1）设置单元格格式-日期
Home-Number-Short Date

2）数据-分列
数据分列第三步列格式选日期，另外YMD格式要与数字格式一致

1.7.5 二维表转一维表
1） 数据透视表法：多重合并计算（Alt+D +P)
Alt+D +P - 调出PivotTable和PivotChart向导 - Mutiple consolidation ranges-next
- next-Range里面选取要转换的区域 - Add 添加 - Finish - 点击透视表的汇总项

作业3
- 如何实现三维转一维的效果














